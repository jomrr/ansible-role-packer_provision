---
# role: jomrr.packer_provision
# file: tasks/apt.yml

- name: "Role packer_provision | Install packages and builder-specific guest extensions"
  ansible.builtin.apt:
    name: "{{ packer_provision_packages | default([], true) }}"
    install_recommends: false
    update_cache: true
    upgrade: dist
    state: present
  loop:
    - "{{ packer_provision_packages }}"
    - "{{ packer_provision_guest_extensions[packer_builder_type] }}"

- name: "Role packer_provision | Remove and clean packages"
  ansible.builtin.apt:
    name: "{{ packer_provision_packages_clean | default([], true) }}"
    autoclean: true
    autoremove: true
    clean: true
    purge: true
    state: absent
